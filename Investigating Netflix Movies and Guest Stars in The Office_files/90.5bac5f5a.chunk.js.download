/*! For license information please see 90.5bac5f5a.chunk.js.LICENSE.txt */
(this["webpackJsonp@dcmfe/mfe-app-workspace"]=this["webpackJsonp@dcmfe/mfe-app-workspace"]||[]).push([[90],{"./src/notebookViewer/WrappedNotebookViewer.tsx":function(e,t,n){"use strict";n.r(t);var a=n("../../node_modules/@babel/runtime/helpers/defineProperty.js"),o=n.n(a),r=n("../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),i=n.n(r),c=n("../../node_modules/@babel/runtime/helpers/slicedToArray.js"),s=n.n(c),l=n("../../node_modules/@datacamp/waffles/esm/tokens/tokens.js"),d=n("../../node_modules/@nteract/commutable/lib/index.js"),u=n("../../node_modules/lodash.clonedeep/index.js"),b=n.n(u),m=n("react"),p=n("../../libs/components/collab-publications/dist/es/lib/getCellHiddenMetadata.js"),h=function(e){var t,n,a=null===(t=e.metadata.get("kernelspec"))||void 0===t?void 0:t.get("language"),o=null===(n=e.metadata.get("jupytext"))||void 0===n?void 0:n.get("main_language");return null!==a&&void 0!==a?a:o},f=n("../../libs/components/collab-publications/dist/es/styles.js"),g=n("../../libs/components/collab-publications/dist/es/components/AnyCell.js"),j=n("../../libs/components/collab-publications/dist/es/components/NotebookViewerProvider.js"),v=n("../../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js"),O=function(e){var t,n=e.CellWrapper,a=e.className,r=e.notebook,i=e.syntaxHighlighterLanguage,c=e.workspaceId;return Object(v.b)("div",{className:a,css:[(t={"& > *":{margin:"0 !important"}},o()(t,f.e.tablet,{paddingTop:0}),o()(t,"p",{wordBreak:"break-word"}),o()(t,"paddingTop",l.a.spacing.large),t),"",""],children:r.cellOrder.map((function(e){return[e,r.cellMap.get(e)]})).toArray().map((function(e){var t=s()(e,2),a=t[0],o=t[1];if(null==o)return null;var r=Object(p.a)(o);return r.outputsHidden&&r.sourceHidden?null:null==n?Object(v.b)(g.a,{cell:o,cellId:a,syntaxHighlighterLanguage:i},a):Object(v.b)(n,{cellId:a,workspaceId:c,children:Object(v.b)(g.a,{cell:o,cellId:a,syntaxHighlighterLanguage:i})},a)}))})};O.propTypes={};var y=function(e){var t,n=e.className,a=e.notebook,o=Object(m.useMemo)((function(){return Object(d.fromJS)(b()(a))}),[a]),r=Object(j.b)(),i=r.CellWrapper,c=r.syntaxHighlighterLanguage,s=r.workspaceId;return Object(v.b)(O,{CellWrapper:i,className:n,notebook:o,syntaxHighlighterLanguage:(null!==(t=null!==c&&void 0!==c?c:h(o))&&void 0!==t?t:"").toLowerCase(),workspaceId:s})};y.propTypes={};var w=["className","notebook"];function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var k=function(e){var t=e.className,n=e.notebook,a=i()(e,w);return Object(v.b)(j.a,C(C({},a),{},{children:Object(v.b)(y,{className:t,notebook:n})}))},S=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),_=n("../../libs/shared/domain/dist/es/domains/commenting/domain.js"),I=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),L=n("../../node_modules/@datacamp/waffles/esm/button/button.js"),T=n("../../node_modules/@datacamp/waffles/esm/helpers/hex-to-rgba.js"),M=n("../../node_modules/@datacamp/waffles/esm/hooks/use-media-query.js"),D=n("../../node_modules/@datacamp/waffles/esm/icon/generated/chat.js"),E=n("../../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),z=n("../../node_modules/react-cool-onclickoutside/dist/index.esm.js"),P=n("../../node_modules/react-use/esm/useEffectOnce.js"),W=n("./src/ScreenSizeProvider.tsx"),N=n("./src/tracking/index.tsx"),B=n("./src/useLinkClick.tsx"),F=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),A=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),G=n("../../libs/shared/domain/dist/es/types/PII.js"),H=n("../../node_modules/fp-ts/es6/index.js"),R=n("../../node_modules/stream-chat-react/dist/context/MessageInputContext.js"),V=n("../../node_modules/stream-chat-react/dist/components/Channel/Channel.js"),U=n("../../node_modules/stream-chat-react/dist/components/MessageList/MessageList.js"),q=n("../../node_modules/stream-chat-react/dist/components/MessageInput/MessageInput.js"),J=n("./src/api/collabApi.ts"),Y=n("./src/publicProfile/Avatar.tsx"),K=n("./src/sentry.ts"),Q=n("./src/styles.ts"),X=n("../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),Z=n("../../node_modules/@datacamp/waffles/esm/link/link.js"),$=n("../../node_modules/@datacamp/waffles/esm/text/text.js"),ee=n("../../node_modules/@datacamp/waffles/esm/toast/toast-context.js"),te=n("../../node_modules/stream-chat-react/dist/context/ChatContext.js"),ne=n("../../node_modules/stream-chat-react/dist/components/Message/hooks/useFlagHandler.js"),ae=n("../../node_modules/stream-chat-react/dist/components/Message/MessageText.js"),oe=n("../../node_modules/stream-chat-react/dist/context/MessageContext.js"),re=n("../../node_modules/stream-chat-react/dist/components/Message/hooks/useEditHandler.js"),ie=n("./src/config.ts"),ce=n("./src/redact.ts"),se=n("./src/useIsMobileWebView.ts"),le=n("../../node_modules/@datacamp/waffles/esm/icon/generated/more.js"),de=n("../../node_modules/@datacamp/waffles/esm/icon/generated/edit.js"),ue=n("../../node_modules/@datacamp/waffles/esm/icon/generated/trash.js"),be=n("../../node_modules/@datacamp/waffles/esm/icon/generated/forbidden.js"),me=n("../../node_modules/@datacamp/waffles/esm/menu/menu.js"),pe=function(e){var t=e.onDelete,n=e.onEdit,a=e.onFlag;return Object(v.b)(me.a,{css:{width:175},trigger:Object(v.b)(L.a,{"aria-label":"comment options",css:{"&:hover":{color:l.a.colors.navy},color:l.a.colors.navySubtleTextOnLight},icon:Object(v.b)(le.a,{}),size:"small",type:"button",variant:"plain"}),children:Object(v.c)(me.a.Category,{noDivider:!0,children:[null!=n&&Object(v.b)(me.a.Item,{iconLeft:Object(v.b)(de.a,{}),label:"Edit comment",onClick:n}),null!=t&&Object(v.b)(me.a.Item,{iconLeft:Object(v.b)(ue.a,{}),label:"Delete comment",onClick:t,variant:"destructive"}),null!=a&&Object(v.b)(me.a.Item,{iconLeft:Object(v.b)(be.a,{}),label:"Report comment",onClick:a})]})})},he=n("./src/commenting/contexts/usePublicationCommenting.ts"),fe=n("../../node_modules/stream-chat-react/dist/components/ChatAutoComplete/ChatAutoComplete.js"),ge=n("./src/util/noop.ts"),je=function(){var e,t=Object(oe.b)().message,n=Object(R.b)(),a=n.clearEditingState,o=n.handleSubmit,r=n.text,i=Object(m.useCallback)((function(e){null!=e&&o(e)}),[o]);return Object(v.c)("div",{css:{".str-chat__textarea__textarea":{fontFamily:l.a.fontFamilies.sansSerif,fontSize:l.a.fontSizes.medium,padding:l.a.spacing.xsmall,resize:"none",width:"100%"},width:"100%"},children:[Object(v.c)("div",{css:{".str-chat__textarea":{flexGrow:1,zIndex:l.a.zIndex.default},alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"flex-start"},children:[Object(v.b)(Y.a,{avatar:Object(G.a)(null===(e=t.user)||void 0===e?void 0:e.image),css:{marginBottom:6},size:"xsmall"}),Object(v.b)(fe.a,{})]}),Object(v.c)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",gap:l.a.spacing.small,justifyContent:"flex-end"},children:[Object(v.b)(L.a,{onClick:null==a?ge.a:a,size:"small",type:"button",variant:"plain",children:"Cancel"}),Object(v.b)(L.a,{disabled:""===r,onClick:i,size:"small",type:"button",children:"Save Changes"})]})]})},ve=864e5;function Oe(){Oe=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",r=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(S){c=function(e,t,n){return e[t]=n}}function s(e,t,n,a){var o=t&&t.prototype instanceof u?t:u,r=Object.create(o.prototype),i=new x(a||[]);return r._invoke=function(e,t,n){var a="suspendedStart";return function(o,r){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===o)throw r;return k()}for(n.method=o,n.arg=r;;){var i=n.delegate;if(i){var c=O(i,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var s=l(e,t,n);if("normal"===s.type){if(a=n.done?"completed":"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(a="completed",n.method="throw",n.arg=s.arg)}}}(e,n,i),r}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(S){return{type:"throw",arg:S}}}e.wrap=s;var d={};function u(){}function b(){}function m(){}var p={};c(p,o,(function(){return this}));var h=Object.getPrototypeOf,f=h&&h(h(C([])));f&&f!==t&&n.call(f,o)&&(p=f);var g=m.prototype=u.prototype=Object.create(p);function j(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){function a(o,r,i,c){var s=l(e[o],e,r);if("throw"!==s.type){var d=s.arg,u=d.value;return u&&"object"==typeof u&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){a("next",e,i,c)}),(function(e){a("throw",e,i,c)})):t.resolve(u).then((function(e){d.value=e,i(d)}),(function(e){return a("throw",e,i,c)}))}c(s.arg)}var o;this._invoke=function(e,n){function r(){return new t((function(t,o){a(e,n,t,o)}))}return o=o?o.then(r,r):r()}}function O(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,O(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var a=l(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function y(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(y,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:k}}function k(){return{value:void 0,done:!0}}return b.prototype=m,c(g,"constructor",m),c(m,"constructor",b),b.displayName=c(m,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,i,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},j(v.prototype),c(v.prototype,r,(function(){return this})),e.AsyncIterator=v,e.async=function(t,n,a,o,r){void 0===r&&(r=Promise);var i=new v(s(t,n,a,o),r);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j(g),c(g,i,"Generator"),c(g,o,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=C,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return i.type="throw",i.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],i=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var c=n.call(r,"catchLoc"),s=n.call(r,"finallyLoc");if(c&&s){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var i=r?r.completion:{};return i.type=e,i.arg=t,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var o=a.arg;w(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}var ye=function(e){var t,n,a=e.message,o=e.setEdit,r=Object(te.b)().client,i=Object(ee.b)().toast,c=Object(ne.a)(a,{notify:function(){return i({title:"Message reported",variant:"success"})}}),s=Object(se.a)().isMobileWebView,d=Object(m.useCallback)(Object(X.a)(Oe().mark((function e(){return Oe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.deleteMessage(a.id,!0);case 3:i({title:"Message deleted",variant:"success"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),i({title:"Failed to delete the message, please retry.",variant:"error"});case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),[a,r,i]),u=Object(m.useState)(),b=Object(S.a)(u,2),p=b[0],h=b[1],f=Object(m.useMemo)((function(){return null==a.created_at?null:new Date(a.created_at).toLocaleString()}),[a.created_at]);Object(m.useEffect)((function(){var e=function(){if(null!=a.created_at){var e=new Date(a.created_at);h(function(e){var t=new Date(e),n=t.getDate(),a=t.toLocaleString("en-US",{hour:"2-digit",hour12:!0,minute:"2-digit"}).toLocaleUpperCase(),o=new Date,r=o.getTime()-ve,i=r-ve,c=new Date;return c.setDate(c.getDate()-1),e>r&&n===o.getDate()?"Today, ".concat(a):e>i&&n===c.getDate()?"Yesterday, ".concat(a):"".concat(t.toLocaleString("default",{month:"short"})," ").concat(t.getUTCDate(),", ").concat(a)}(e.getTime()))}};e();var t=setInterval(e,1e4);return function(){return clearInterval(t)}}),[a.created_at]);var g,j,O=null!=r.user&&(null===(t=a.user)||void 0===t?void 0:t.id)===r.user.id,y=function(){var e,t,n,o;return null!==(e=null!==(t=null===(n=a.user)||void 0===n?void 0:n.fullName)&&void 0!==t?t:null===(o=a.user)||void 0===o?void 0:o.name)&&void 0!==e?e:""};return Object(v.c)(v.a,{children:[Object(v.c)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"flex-start"},children:[Object(v.b)(Y.a,{avatar:Object(G.a)(null===(n=a.user)||void 0===n?void 0:n.image),size:"xsmall"}),null!=a.user&&(s?Object(v.b)($.a,{css:{fontWeight:l.a.fontWeights.bold,marginRight:l.a.spacing.small},children:y()}):Object(v.b)(Z.a,Object(I.a)(Object(I.a)({css:{fontWeight:l.a.fontWeights.bold,marginRight:l.a.spacing.small}},Object(ce.a)({attributes:["href"],text:!0}).attributes),{},{href:"".concat(ie.a.urls.datacamp,"/profile/").concat(a.user.name),children:y()}))),null!=f&&Object(v.b)("time",{css:{color:l.a.colors.navySubtleTextOnLight},dateTime:f,title:f,children:p}),(g=a.created_at,j=a.updated_at,!(null==g||null==j?g===j:new Date(g).getTime()===new Date(j).getTime())&&Object(v.b)($.a,{css:{color:l.a.colors.navySubtleTextOnDark,marginLeft:l.a.spacing.xsmall},children:"(edited)"}))]}),Object(v.b)("div",{css:{marginLeft:l.a.spacing.xlarge,ol:{listStyleType:"decimal",paddingInlineStart:l.a.spacing.medium},overflowWrap:"anywhere",p:{marginBottom:0,marginTop:0},ul:{listStyleType:"circle",paddingInlineStart:l.a.spacing.medium}},children:Object(v.b)(ae.a,{})}),Object(v.b)("div",{css:{position:"absolute",right:0,top:0},children:Object(v.b)(pe,{onDelete:O?d:void 0,onEdit:O?o:void 0,onFlag:O?void 0:c})})]})},we=function(e){var t=e.clearEdit,n=e.message,a=Object(he.a)();return Object(v.b)(q.a,{Input:je,additionalTextareaProps:a.canComment?{maxLength:a.maxMessageLength}:{},clearEditingState:t,disableMentions:!0,focus:!0,grow:!0,message:n})},xe=function(){var e=Object(oe.b)().message,t=Object(re.a)(),n=t.clearEdit,a=t.editing,o=t.setEdit;return Object(v.b)("div",{css:{alignItems:"flex-start",display:"flex",flexDirection:"column",fontFamily:"".concat(l.a.fontFamilies.sansSerif," !important"),justifyContent:"center",marginBottom:l.a.spacing.small,position:"relative"},children:a?Object(v.b)(we,{clearEdit:n,message:e}):Object(v.b)(ye,{message:e,setEdit:o})})},Ce=n("./src/Card.tsx"),ke=n("../../node_modules/react/jsx-runtime.js"),Se=Object(m.createContext)({onCancelMessageInput:null,setShowControls:null,showControls:!0,toggleChannel:null}),_e=function(e){var t=e.children,n=e.onCancelMessageInput,a=e.setShowControls,o=e.showControls,r=e.toggleChannel,i=Object(m.useMemo)((function(){return{onCancelMessageInput:null==n?null:n,setShowControls:null==a?null:a,showControls:null==o||o,toggleChannel:null==r?null:r}}),[n,o,r,a]);return Object(ke.jsx)(Se.Provider,{value:i,children:t})},Ie=function(){return Object(m.useContext)(Se)},Le=function(e){var t=e.avatar,n=e.isScreenTooSmall,a=Ie(),o=a.onCancelMessageInput,r=a.setShowControls,i=Object(R.b)(),c=i.handleSubmit,s=i.setText,d=i.text,u=Object(m.useCallback)((function(e){null!=e&&c(e)}),[c]);return Object(v.c)("div",{css:{".str-chat__textarea__textarea":{fontFamily:l.a.fontFamilies.sansSerif,fontSize:l.a.fontSizes.medium,padding:n?l.a.spacing.medium:l.a.spacing.xsmall,paddingTop:n?l.a.spacing.small:l.a.spacing.xsmall,resize:"none",width:"100%"},display:"flex",flexDirection:"column",gap:l.a.spacing.small,padding:l.a.spacing.small},children:[Object(v.c)("div",{css:{".str-chat__textarea":{display:"flex",flexGrow:1,minHeight:l.a.sizing.small,padding:0,zIndex:l.a.zIndex.default},alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"flex-start"},children:[t,Object(v.b)(fe.a,{})]}),Object(v.c)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",gap:l.a.spacing.small,justifyContent:"flex-end"},children:[Object(v.b)(L.a,{disabled:null==o||null==r,onClick:function(e){null!=o&&n&&null!=r&&(s(""),o(e),r(!1))},size:"small",type:"button",variant:"plain",children:"Cancel"}),Object(v.b)(L.a,{disabled:""===d,onClick:u,size:"small",type:"button",children:"Send"})]})]})},Te=function(){var e,t,n=Object(W.b)().isScreenTooSmall,a=Ie().showControls,o=Object(te.b)().client;return!0===n?a?Object(v.b)(Ce.a,{css:{"> div:first-child":{left:l.a.spacing.small},background:l.a.colors.greySubtle,border:"".concat(l.a.borderWidth.thin," solid ").concat(l.a.colors.greyMedium),borderRadius:l.a.borderRadius.medium,bottom:l.a.spacing.medium,marginLeft:"-".concat(l.a.spacing.small),padding:"".concat(l.a.spacing.large," ").concat(l.a.spacing.small," ").concat(l.a.spacing.small),position:"fixed",width:"calc(100% - ".concat(l.a.spacing.medium," - ").concat(l.a.spacing.medium,")"),zIndex:l.a.zIndex.overlay},headStone:Object(v.b)(Y.a,{avatar:Object(G.a)(null===(t=o.user)||void 0===t?void 0:t.image)}),children:Object(v.b)(Le,{client:o,isScreenTooSmall:n})}):null:Object(v.b)(Le,{avatar:Object(v.b)(Y.a,{avatar:Object(G.a)(null===(e=o.user)||void 0===e?void 0:e.image),size:"xsmall"}),client:o,isScreenTooSmall:n})},Me=function(e){var t=e.children,n=Object(R.b)(),a=Object(I.a)(Object(I.a)({},n),{},{autocompleteTriggers:{}});return Object(v.b)(R.a,{value:a,children:t})},De=Object(E.b)({":hover, :active, :focus":{borderColor:Object(T.a)(l.a.colors.navy,l.a.opacity.low)},borderBottom:"none",borderColor:Object(T.a)(l.a.colors.navy,l.a.opacity.low),borderRadius:0,borderWidth:l.a.borderWidth.thin,flex:1,height:l.a.sizing.medium}),Ee=function(e){var t=e.className,n=e.messages,a=Object(m.useMemo)((function(){return n.reduce((function(e,t){var n,a=null===(n=t.user)||void 0===n?void 0:n.image;return null==a||e.includes(a)?e:[].concat(Object(A.a)(e),[a])}),[]).slice(0,5)}),[n]);return Object(v.b)("div",{className:t,css:{alignItems:"center",display:"flex"},children:a.map((function(e){return Object(v.b)(Y.a,{avatar:Object(G.a)(e),css:{margin:"0 6px ".concat(l.a.spacing.small," -13px"),marginBottom:0,position:"relative"},size:"xsmall"},e)}))})},ze=function(e){var t,n=e.autoFocus,a=void 0!==n&&n,o=e.channel,r=e.messages,i=void 0===r?[]:r,c=e.onCancelMessageInput,s=e.showControls,d=e.cellId,u=e.workspaceId,b=e.setShowControls,p=Object(m.useState)(!0),h=Object(S.a)(p,2),f=h[0],g=h[1],j=Object(he.a)(),O=Object(W.b)().isScreenTooSmall,y=Object(m.useMemo)((function(){return i.filter((function(e){return null==e.deleted_at}))}),[i]),w=Object(m.useMemo)((function(){return i.reduce((function(e,t){var n,a=null===(n=t.user)||void 0===n?void 0:n.id;return null==a||e.includes(a)?e:[].concat(Object(A.a)(e),[a])}),[]).slice(0,5)}),[i]),x=Object(m.useCallback)((function(e,t){return null!=t.id&&J.a.commenting.notifyUsersOfComment({body:{cellId:d,messageId:t.id,workspaceId:u}}).then((function(e){H.b.isLeft(e)&&K.b.captureMessage("Failed to notify users of comment: ".concat(e.left.errorType))})),window.dcmfeSnowplow("trackStructEvent",{action:"create-comment",category:"commenting",label:"mfe-app-workspace",property:u}),o.sendMessage(t)}),[o,d,u]),C=Object(m.useMemo)((function(){var e;return null==o.id||j.canComment&&!0!==(null===(e=j.channelsSettings[o.id])||void 0===e?void 0:e.hide)}),[o,j]),k=Object(m.useCallback)((function(){return!!j.canComment&&(null!=o.id&&j.hideChannel(o.id,C))}),[o,j,C]);return j.canComment?Object(v.b)(_e,{onCancelMessageInput:c,setShowControls:b,showControls:s,toggleChannel:k,children:Object(v.b)(V.a,{Input:Te,Message:xe,TriggerProvider:Me,channel:o,doSendMessageRequest:x,children:Object(v.c)("div",{css:{backgroundColor:l.a.colors.greySubtle,border:C&&(!O||y.length>0)?"".concat(l.a.borderWidth.thin," solid ").concat(l.a.colors.greyMedium):"none",borderRadius:l.a.borderRadius.medium,fontSize:l.a.fontSizes.medium,marginTop:l.a.spacing.small,ul:{listStyleType:"none",margin:0,padding:0}},children:[Object(v.b)("div",{css:(t={display:C?"block":"none"},Object(F.a)(t,Q.q.tablet,{display:C&&y.length>0?"block":"none"}),Object(F.a)(t,"padding",0===y.length?0:l.a.spacing.small),t),children:i.length<=3||!f?Object(v.b)(U.a,{disableDateSeparator:!0,hideDeletedMessages:!0,messages:i,noGroupByUser:!0}):Object(v.c)(v.a,{children:[Object(v.b)(U.a,{disableDateSeparator:!0,hideDeletedMessages:!0,messages:i.slice(0,1),noGroupByUser:!0}),Object(v.c)(L.a,{css:{fontSize:l.a.fontSizes.medium,marginBottom:l.a.spacing.small},onClick:function(){return g(!1)},size:"small",type:"button",variant:"plain",children:["Show ",i.length-3," more"," ",i.length-3===1?"reply":"replies"]}),Object(v.b)(U.a,{disableDateSeparator:!0,hideDeletedMessages:!0,messages:i.slice(i.length-2),noGroupByUser:!0})]})}),(0===y.length||C)&&Object(v.b)(q.a,{additionalTextareaProps:{maxLength:j.maxMessageLength},disableMentions:!0,focus:a,grow:!0}),!1===O?Object(v.c)("div",{css:{display:y.length>0?"flex":"none",justifyContent:"center",marginTop:C?l.a.spacing.xsmall:0,paddingBottom:l.a.spacing.xsmall,paddingLeft:null==w||C?0:6*w.length,paddingTop:l.a.spacing.xsmall},children:[!C&&Object(v.b)(Ee,{messages:i}),Object(v.c)(L.a,{css:{color:l.a.colors.blueDarkText,fontSize:l.a.fontSizes.medium},onClick:k,size:"small",type:"button",variant:"plain",children:[C?"Hide":"Show"," discussion"]})]}):C&&0!==y.length&&Object(v.c)("div",{css:{display:"flex",gap:0,span:{color:l.a.colors.blueDarkText},width:"100%"},children:[Object(v.b)(L.a,{css:[De,{borderLeft:"none",borderRight:"none"}],iconLeft:Object(v.b)(D.a,{color:l.a.colors.blueDarkText}),onClick:function(){b(!0)},type:"button",variant:"secondary",children:"Add Comment"}),Object(v.b)(L.a,{css:[De,{borderBottom:"none",borderRight:"none"}],onClick:function(e){null!=c&&c(e),b(!1),k()},type:"button",variant:"secondary",children:"Hide discussion"})]})]})})}):null},Pe=Object(E.b)({color:l.a.colors.blueDarkText}),We=function(e){var t=e.onCommentButtonClicked,n=Object(M.a)().isAboveLarge;return Object(v.b)("div",{css:{height:"100%",left:"100%",position:"absolute"},children:Object(v.b)(L.a,Object(I.a)(Object(I.a)({className:"commentButton",css:{backgroundColor:l.a.colors.white,border:"".concat(l.a.borderWidth.thin," solid ").concat(Object(T.a)(l.a.colors.navy,l.a.opacity.low)),fontWeight:l.a.fontWeights.regular,marginTop:1,position:"sticky",top:130,visibility:"hidden",whiteSpace:"nowrap"},"data-trackid":Object(N.c)("toggle-publication-cell-comment-input")},n?{children:"Add comment",iconLeft:Object(v.b)(D.a,{css:Pe})}:{"aria-label":"Add comment",icon:Object(v.b)(D.a,{css:Pe})}),{},{onClick:t,variant:"secondary"}))})},Ne=function(e){var t=e.messages,n=e.onCommentButtonClicked,a=Object(m.useMemo)((function(){return t.filter((function(e){return null==e.deleted_at}))}),[t]);return Object(v.b)(L.a,{css:Object(I.a)({background:l.a.colors.greySubtle,borderColor:l.a.colors.greyMedium,borderWidth:l.a.borderWidth.thin,marginTop:l.a.spacing.small},a.length>0&&{color:l.a.colors.blueDarkText}),fullWidth:!0,iconLeft:a.length>0?Object(v.b)(Ee,{messages:t}):Object(v.b)(D.a,{}),onClick:n,type:"button",variant:"secondary",children:a.length>0?"Show discussion":"Comment"})},Be=function(e){var t=e.color,n=e.isScreenTooSmall;return{border:"".concat(l.a.borderWidth.thin," solid ").concat(t),borderRadius:l.a.borderRadius.medium,margin:n?0:"-".concat(l.a.spacing.small),padding:l.a.spacing.small}},Fe=function(e){var t=e.cellId,n=e.channel,a=e.children,o=e.messages,r=e.workspaceId,i=Object(m.useState)(!1),c=Object(S.a)(i,2),s=c[0],d=c[1],u=Object(m.useRef)(null),b=Object(he.a)(),p=Object(W.b)().isScreenTooSmall,h=Object(m.useCallback)((function(){d((function(e){return!e})),b.canComment&&null!=n.id&&b.hideChannel(n.id,!1)}),[n,b]);return Object(P.a)((function(){!1!==p&&b.canComment&&null!=n.id&&b.hideChannel(n.id,!0)})),Object(z.a)((function(){return setTimeout((function(){return d(!1)}),150)}),{refs:[u]}),Object(v.c)("div",{css:{":hover":{".commentButton":{visibility:"visible"}},alignItems:p?"center":"flex-start",display:"flex",flexDirection:!0===p?"column":"row",position:"relative"},ref:u,children:[Object(v.c)("div",{css:[Be({color:s?l.a.colors.blueDark:"transparent",isScreenTooSmall:p}),Object(I.a)(Object(I.a)({":hover":s?void 0:Be({color:l.a.colors.greyMedium,isScreenTooSmall:p})},p&&0===o.length&&{display:"flex",flexDirection:"column"}),{},{position:"relative",width:"100%"})],children:[a,Object(v.b)("div",{css:Object(I.a)({display:s||o.length>0?"block":"none"},p&&0===o.length&&{height:0,overflow:"hidden"}),onClick:function(e){Object(B.b)(e)||d(!0)},children:Object(v.b)(ze,{autoFocus:s,cellId:t,channel:n,messages:o,onCancelMessageInput:function(e){Object(B.a)(e),d(!1)},setShowControls:d,showControls:s,workspaceId:r},n.id)}),!0===p&&!s&&Object(v.b)(Ne,{messages:o,onCommentButtonClicked:h})]}),!1===p&&Object(v.b)(We,{onCommentButtonClicked:h})]})},Ae=function(){},Ge=function(e){var t=e.cellId,n=e.channels,a=e.children,o=e.client,r=e.workspaceId,i=Object(m.useState)(),c=Object(S.a)(i,2),s=c[0],l=c[1],d=Object(m.useState)([]),u=Object(S.a)(d,2),b=u[0],p=u[1],h=Object(m.useCallback)((function(){var e;return p(null!==(e=null===s||void 0===s?void 0:s.state.messages)&&void 0!==e?e:[])}),[s]);return Object(m.useEffect)((function(){var e=n.find((function(e){return e.id===Object(_.a)({cellId:t,workspaceId:r})}));if(l(e),null==e)return Ae;l(e),p(e.state.messages);var a=function(t){"message.new"!==t.type&&"message.deleted"!==t.type&&"message.updated"!==t.type||t.channel_id===e.id&&h()};return o.on(a),function(){return o.off(a)}}),[n,o,r,t,h]),null==s?Object(v.b)(v.a,{children:a}):Object(v.b)(Fe,{cellId:t,channel:s,messages:b,workspaceId:r,children:a})},He=function(e){var t=e.cellId,n=e.children,a=e.workspaceId,o=Object(he.a)();return o.canComment&&null!=o.channels&&null!=a?Object(v.b)(Ge,{cellId:t,channels:o.channels,client:o.client,workspaceId:a,children:n}):Object(v.b)(v.a,{children:n})},Re=n("./src/publicationView/usePublicationView.ts"),Ve=n("./src/reducer.ts"),Ue=n("./src/notebookViewer/media/index.ts");t.default=function(e){var t=e.className,n=e.notebook,a=e.workspaceId,o=Object(Ve.c)(Re.a),r=Object(m.useMemo)((function(){if(null!=a){var e=o[a];return"succeeded"===(null===e||void 0===e?void 0:e.status)?e.data.language:void 0}}),[o,a]);return Object(ke.jsx)(k,{CellWrapper:He,Markdown:Ue.a,className:t,notebook:n,sentryClient:K.b,syntaxHighlighterLanguage:r,workspaceId:a})}}}]);
//# sourceMappingURL=90.5bac5f5a.chunk.js.map